@import conf.WebAppConfig
@import controllers.candidat.SaisieCriteresRechercheForm
@import fr.poleemploi.perspectives.domain.authentification.CandidatAuthentifie
@import fr.poleemploi.perspectives.domain.{RayonRecherche, SecteurActivite}
@import fr.poleemploi.perspectives.projections.candidat.CandidatDto
@import helper._

@(saisieCriteresRechercheForm: Form[SaisieCriteresRechercheForm],
        candidatDto: Option[CandidatDto],
        candidatAuthentifie: CandidatAuthentifie)(implicit request: MessagesRequestHeader, flash: Flash, webAppConfig: WebAppConfig)

@hasErrors(field:String) = @{
    saisieCriteresRechercheForm(field).hasErrors
}

@erreurSelectionMetier() = @{
    saisieCriteresRechercheForm.globalErrors.find(_.messages.contains("constraint.criteres.selectionmetiers"))
}

@layout(candidatAuthentifie = Some(candidatAuthentifie), cssClassesBody = List("degradeGrisBlanc")) {
<div id="saisieCriteresRechercheCandidat">
    <section class="presentation">
        <header class="presentationTitres">
            <h2 class="presentationTitres-titre">Choisissez vos critères</h2>
            <p class="presentationTitres-description">Faisons connaissance et bénéficiez rapidement de mises en relation avec des employeurs, agences d'interim et organismes de formation.</p>
        </header>
        <div class="separation">
            <span class="separation-ligne"></span>
        </div>
    </section>
    <section class="criteres">
        @form(action = controllers.candidat.routes.SaisieCriteresRechercheController.modifierCriteresRecherche(), 'id -> "criteresRechercheForm", 'enctype -> "multipart/form-data") {
        @CSRF.formField
        <input type="hidden" name="nouveauCandidat" value="@saisieCriteresRechercheForm("nouveauCandidat").value" />
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("rechercheMetierEvalue")){question-puce--erreur}">1</span>
                <div class="question-texte">
                    Cherchez-vous toujours sur le métier pour lequel vous avez été évalué ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
                @components.radioOuiNon(saisieCriteresRechercheForm, "rechercheMetierEvalue")
            </dd>
            @if(hasErrors("rechercheMetierEvalue")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("rechercheMetierEvalue").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("rechercheAutreMetier")){question-puce--erreur}">2</span>
                <div class="question-texte">
                    Recherchez-vous un autre métier ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
                @components.radioOuiNon(saisieCriteresRechercheForm, "rechercheAutreMetier")
            </dd>
            @if(hasErrors("rechercheAutreMetier")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("rechercheAutreMetier").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
            @if(erreurSelectionMetier.isDefined) {
            <dd class="erreurs">
                <span class="erreurs-item">@erreurSelectionMetier.get.format</span>
            </dd>
            }
        </dl>
        <dl id="js-critere-metiers" class="critere">
            <dt class="sousQuestion">
                <div class="sousQuestion-texte">
                    Si oui, lesquels ?
                    <span class="sousQuestion-requise">*</span>
                </div>
                <p class="sousQuestion-aide">Choisissez-en autant que vous le souhaitez</p>
            </dt>
            <dd class="choixMetiers">
                <span class="ligneVerticaleSecteurs"></span>
                <ul class="secteursActivites">
                    <li>
                        <input id="secteurActivite-1"
                        name="secteurActivite"
                        type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-1">
                            <span class="checkmark"></span>
                            @SecteurActivite.INDUSTRIE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                            @for(metier <- SecteurActivite.INDUSTRIE.metiers) {
                                <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                            }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-2"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-2">
                            <span class="checkmark"></span>
                            @SecteurActivite.COMMERCE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.COMMERCE.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-3"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-3">
                            <span class="checkmark"></span>
                            @SecteurActivite.BATIMENT.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.BATIMENT.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-4"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-4">
                            <span class="checkmark"></span>
                            @SecteurActivite.HOTELLERIE_RESTAURATION.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.HOTELLERIE_RESTAURATION.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-5"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-5">
                            <span class="checkmark"></span>
                            @SecteurActivite.AGRICULTURE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.AGRICULTURE.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-6"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-6">
                            <span class="checkmark"></span>
                            @SecteurActivite.TEXTILE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.TEXTILE.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-7"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-7">
                            <span class="checkmark"></span>
                            @SecteurActivite.SERVICES_A_LA_PERSONNE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.SERVICES_A_LA_PERSONNE.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                    <li>
                        <input id="secteurActivite-8"
                               name="secteurActivite"
                               type="checkbox" value="" />
                        <label class="labelSecteurActivite" for="secteurActivite-8">
                            <span class="checkmark"></span>
                            @SecteurActivite.TRANSPORT_LOGISTIQUE.label
                            <span class="compteur-metiers-selectionnes"></span>
                        </label>
                        <div class="conteneurMetiers">
                            <span class="ligneVerticaleMetiers"></span>
                            <ul class="metiers">
                                @for(metier <- SecteurActivite.TRANSPORT_LOGISTIQUE.metiers) {
                                    <li class="metiers-item">@components.checkboxMetier(saisieCriteresRechercheForm, metier)</li>
                                }
                            </ul>
                        </div>
                    </li>
                </ul>
            </dd>
            @if(hasErrors("listeMetiersRecherches")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("listeMetiersRecherches").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("contactInterim")){question-puce--erreur}">3</span>
                <div class="question-texte">
                    Acceptez-vous d'être contacté pour des missions d'interim ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
                @components.radioOuiNon(saisieCriteresRechercheForm, "contactInterim")
            </dd>
            @if(hasErrors("contactInterim")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("contactInterim").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("contactFormation")){question-puce--erreur}">4</span>
                <div class="question-texte">
                    Acceptez-vous d'être contacté pour une formation sur ces métiers ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
                @components.radioOuiNon(saisieCriteresRechercheForm, "contactFormation")
            </dd>
            @if(hasErrors("contactFormation")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("contactFormation").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("rayonRecherche")){question-puce--erreur}">5</span>
                <div class="question-texte">
                    Combien de km acceptez-vous de faire ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
            @for(rayonRecherche <- RayonRecherche.values.values) {
                <span class="choix-item">
                    <input id="rayonRecherche-@rayonRecherche.value"
                           name="rayonRecherche"
                           type="radio" value="@rayonRecherche.value"
                    @if(saisieCriteresRechercheForm("rayonRecherche").value.contains(rayonRecherche.value.toString)) {
                        checked
                    }/>
                    <label class="labelRadio" for="rayonRecherche-@rayonRecherche.value">
                        @(rayonRecherche match {
                            case RayonRecherche.MAX_100 => "Plus de 50km"
                            case r@_ => s"Moins de ${r.value}km"
                        })
                        <span class="labelRadio-circle"></span>
                    </label>
                </span>
            }
            </dd>
            @if(hasErrors("rayonRecherche")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("rayonRecherche").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("numeroTelephone")){question-puce--erreur}">6</span>
                <div class="question-texte">
                    Quel est votre numéro de téléphone ?
                    <span class="question-requise">*</span>
                </div>
            </dt>
            <dd class="choix">
                <input id="numeroTelephone"
                       name="numeroTelephone"
                       type="text"
                       maxlength="11"
                       placeholder="Saisissez votre numéro de téléphone ici"
                       value="@saisieCriteresRechercheForm("numeroTelephone").value"/>
            </dd>
            @if(hasErrors("numeroTelephone")) {
            <dd class="erreurs">
                <span class="erreurs-item">@saisieCriteresRechercheForm("numeroTelephone").errors.map(_.format).mkString(", ")</span>
            </dd>
            }
        </dl>
        <dl class="critere">
            <dt class="question">
                <span class="question-puce @if(hasErrors("cv")){question-puce--erreur}">7</span>
                <div class="question-texte">
                    @if(candidatDto.exists(_.hasCV)) {
                        Remplacez votre dernier CV envoyé (pdf, doc, docx, jpg) :
                        <a class="telechargerCV" href="/candidat/cv/telecharger" target="_blank">Voir mon CV</a>
                    } else {
                        Ajoutez votre CV pour obtenir plus de visibilité auprès des recruteurs (pdf, doc, docx, jpg) :
                    }
                </div>
            </dt>
            <dd class="choix">
                <label class="labelUploadFichier" for="js-input-cv">
                    <span class="uploadActions">
                        <span id="js-nom-fichier" class="uploadActions-nomFichier">
                            @candidatDto.flatMap(_.cvId).map(_ => "Remplacer mon CV").getOrElse("Ajouter mon CV")
                        </span>
                        <span class="uploadActions-boutonParcourir">Parcourir</span>
                    </span>
                    <span class="labelUploadFichier-indicationTailleMax">(poids maximum du document 5mo)</span>
                    <input id="js-input-cv" class="labelUploadFichier-input" name="cv" type="file" accept="application/pdf,application/vnd.oasis.opendocument.text,image/jpeg,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"/>
                </label>
            </dd>
            <dd class="erreurs">
                <span id="js-erreur-cv" class="erreurs-item"></span>
                @if(hasErrors("cv")) {
                <span class="erreurs-item">@saisieCriteresRechercheForm("cv").errors.map(_.format).mkString(", ")</span>
                }
            </dd>
        </dl>
        <div class="validerCriteres">
            <button class="bouton bouton-actionPrincipale bouton--fondBleu" type="submit">
                Valider mes critères
            </button>
        </div>
        }
    </section>
</div>
<script src="@routes.Assets.versioned("javascripts/pages/candidat/saisieCriteresRecherche.js")" type="text/javascript"></script>
}