@import conf.WebAppConfig
@import fr.poleemploi.perspectives.authentification.domain.CandidatAuthentifie
@import helper._
@import play.api.libs.json.JsObject

@(candidatAuthentifie: CandidatAuthentifie,
        jsData: JsObject)(implicit flash: Flash, assetsFinder: AssetsFinder, webAppConfig: WebAppConfig)

@layout(candidatAuthentifie = Some(candidatAuthentifie)) {
    <div id="listeOffres" v-cloak>
        <div id="js-modaleDetailOffre" class="modal" tabindex="-1" role="dialog" aria-labelledby="titreModaleDetailOffre">
            <div id="modaleDetailOffre" class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modaleDetailOffre">
                        <div class="row">
                            <div class="intitule">
                                <p class="intitule-titre" id="titreModaleDetailOffre">{{offreCourante.intitule}}</p>
                                <span class="modaleDetailOffre-fermer" data-dismiss="modal">&times;</span>
                            </div>
                            <div class="modaleDetailOffre-colonne resume">
                                <p class="resume-info resume-nomEnteprise">{{offreCourante.nomEntreprise}}</p>
                                <p class="resume-info resume-libelleLieuTravail">
                                    <img src="@assetsFinder.path("images/commun/localisation.svg")" alt="Localisation" height="20" width="14" />
                                    {{offreCourante.libelleLieuTravail}}
                                </p>
                                <p class="resume-info resume-dateActualisation">Actualisée le {{offreCourante.dateActualisation | date}}</p>
                            </div>
                            <div class="modaleDetailOffre-colonne description">
                                <p class="modaleDetailOffre-titreColonne">Description</p>
                                <p v-show="offreCourante.description" class="descriptionOffre">{{offreCourante.description}}</p>
                            </div>
                            <div class="modaleDetailOffre-colonne profilSouhaite">
                                <p class="modaleDetailOffre-titreColonne">Profil souhaité</p>
                                <p>{{offreCourante.libelleExperience}}</p>
                                <p class="modaleDetailOffre-sousTitreColonne">Savoirs et savoir-faire :</p>
                                <ul class="listeSavoirFaire">
                                    <li class="listeSavoirFaire-item" v-for="competence in offreCourante.competences">
                                        {{competence}}
                                    </li>
                                </ul>
                            </div>
                            <div class="modaleDetailOffre-colonne entreprise">
                                <p class="modaleDetailOffre-titreColonne">Entreprise</p>
                                <p class="entreprise-info" v-show="offreCourante.nomEntreprise">{{offreCourante.nomEntreprise}}</p>
                                <p class="entreprise-info" v-show="offreCourante.descriptionEntreprise">{{offreCourante.descriptionEntreprise}}</p>
                                <p class="entreprise-info" v-show="offreCourante.effectifEntreprise">{{offreCourante.effectifEntreprise}}</p>
                                <p class="entreprise-info" v-show="offreCourante.urlEntreprise">{{offreCourante.urlEntreprise}}</p>
                            </div>
                            <div class="modaleDetailOffre-colonne contact">
                                <div class="contrat">
                                    <div class="contrat-info">{{offreCourante.libelleTypeContrat}}</div>
                                    <div class="contrat-info">{{offreCourante.libelleDureeTravail}}</div>
                                    <div class="contrat-lastInfo">Salaire : {{offreCourante.libelleSalaire}}</div>
                                </div>
                                <div class="postuler">
                                    <p class="postuler-info"><b>Cette offre vous intéresse ?</b></p>
                                    <p class="postuler-info" v-show="display.contact"><b>Postuler en contactant directement :</b></p>
                                    <button class="bouton bouton-actionPrincipale bouton--bleu boutonPostuler"
                                            v-show="!display.contact" v-on:click="display.contact = true">Contacter le recruteur</button>
                                    <div class="contactRecruteur" v-show="display.contact">
                                        <p class="postuler-info" v-show="offreCourante.nomContact"><b>{{offreCourante.nomContact}}</b></p>
                                        <p class="postuler-info" v-show="offreCourante.telephoneContact">{{offreCourante.telephoneContact}}</p>
                                        <p class="postuler-info" v-show="offreCourante.emailContact">{{offreCourante.emailContact}}</p>
                                        <p class="postuler-info" v-show="offreCourante.coordonneesContact1">{{offreCourante.coordonneesContact1}}</p>
                                        <p class="postuler-info" v-show="offreCourante.coordonneesContact2">{{offreCourante.coordonneesContact2}}</p>
                                        <p class="postuler-info" v-show="offreCourante.coordonneesContact3">{{offreCourante.coordonneesContact3}}</p>
                                        <p class="postuler-info" v-show="!offreCourante.telephoneContact && !offreCourante.emailContact && !offreCourante.coordonneesContact1 && !offreCourante.coordonneesContact2 && !offreCourante.coordonneesContact3">
                                            <a class="lienOrigineOffre" target="_blank" v-bind:href="offreCourante.urlOrigine">{{offreCourante.urlOrigine}}</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <section class="profil">
                <div class="metiersEvalues" v-if="metiersEvaluesParSecteur.length > 0">
                    <h2 class="metiersEvalues-titre">Vos métiers évalués :</h2>
                    <template v-for="secteur in metiersEvaluesParSecteur">
                        <img v-bind:src="'/assets/images/pages/candidat/landing/secteurs/' + secteur.code + '.svg'"
                             v-bind:alt="secteur.label" width="50" height="50"
                             class="secteurActivite-icone"/>
                        <div class="secteurEvalue">
                            <b>{{secteur.label}} :</b>
                            <ul class="listeMetiersEvalues">
                                <li class="listeMrsValidees-item" v-for="metier in secteur.metiers">
                                    {{metier.label}}
                                </li>
                            </ul>
                        </div>
                    </template>
                </div>
                <div class="criteresRecherche">
                    <h2 class="criteresRecherche-titre" v-on:click="display.criteres = !display.criteres">
                        Vos critères de recherche
                        <img alt="Ouvrir criteres" class="criteresRecherche-iconeOuverture"
                             src="@assetsFinder.path("images/commun/ouvrir-detail.svg")" width="16" height="16"
                             v-show="!display.criteres"/>
                        <img alt="Fermer criteres" class="criteresRecherche-iconeFermeture"
                             src="@assetsFinder.path("images/commun/fermer-detail.svg")" width="16" height="16"
                             v-show="display.criteres"/>
                    </h2>
                    <div class="criteres" v-show="display.criteres">
                        <div class="mobilite">
                            <p class="criteresRecherche-sousTitre">Mobilité :</p>
                            <img src="@assetsFinder.path("images/commun/localisation.svg")" alt="Localisation" height="20" width="14"
                                 class="mobilite-icone"/>
                            <div class="localisation">
                                <div><b>{{candidat.commune}}</b></div>
                                <div><b>+{{candidat.rayonRecherche}}km</b></div>
                            </div>
                        </div>
                        <div class="separationProfil"></div>
                        <div class="interessePar" v-if="metiersRecherchesParSecteur.length > 0">
                            <p class="criteresRecherche-sousTitre">Intéréssé par d'autres métiers dans :</p>
                            <template v-for="secteur in metiersRecherchesParSecteur">
                                <img v-bind:src="'/assets/images/pages/candidat/landing/secteurs/' + secteur.code + '.svg'"
                                     v-bind:alt="secteur.label" width="50" height="50"
                                    class="secteurActivite-icone"/>
                                <div class="secteurRecherche">
                                    <b>{{secteur.label}} :</b>
                                    <ul class="listeMetiersRecherches">
                                        <li v-for="metier in secteur.metiers">
                                            {{metier.label}}
                                        </li>
                                    </ul>
                                </div>
                            </template>
                        </div>
                        <div class="interessePar" v-else>
                            <p>Vous trouverez plus d'offres en renseignant des métiers dans vos critères</p>
                        </div>
                        <div class="modifierCriteres">
                            <a class="bouton bouton-actionPrincipale modifierCriteres-bouton" href="@controllers.candidat.routes.SaisieCriteresRechercheController.saisieCriteresRecherche().url">
                                Modifier mes critères
                            </a>
                        </div>
                    </div>
                </div>
            </section>
            <section class="offres">
                <p class="offres-titre" v-if="offres.length > 0"><b>{{offres.length}} offres d'emploi</b> peuvent vous intéresser</p>
                <div class="listeOffres" v-if="offres.length > 0">
                    <template v-for="(offre, index) in offres">
                        <div class="listeOffres-ligne" v-on:click="toggleOffreCourante(offre)" v-show="afficherOffre(index)">
                            <div class="listeOffres-colonne offre">
                                <p class="offre-info offre-intitule">{{offre.intitule}}</p>
                                <p class="offre-info offre-nomEntreprise">{{offre.nomEntreprise | capitalize}}</p>
                                <p class="offre-info offre-lieuTravail">{{offre.libelleLieuTravail}}</p>
                                <p v-show="offre.description" class="offre-info offre-description">{{offre.description | take(100)}}</p>
                            </div>
                            <div class="listeOffres-colonne typeContrat">
                                <b>{{offre.typeContrat}}</b>
                            </div>
                            <div class="listeOffres-colonne actions">
                                <img src="@assetsFinder.path("images/commun/ouvrir-detail.svg")"
                                     alt="Plus de détails" height="16" width="16" class="voirProfil--ferme"/>
                                Détail
                            </div>
                        </div>
                    </template>
                </div>
                <div class="aucuneOffre" v-else>
                    <p class="aucuneOffre-texte"><b>Désolé, nous n'avons pas d'offres à vous proposer pour l'instant :(</b></p>
                    <p class="aucuneOffre-texte">Vous pouvez élargir votre recherche en modifiant vos critères ou réessayer plus tard</p>
                    <div class="modifierCriteres">
                        <a class="bouton bouton-actionPrincipale modifierCriteres-bouton" href="@controllers.candidat.routes.SaisieCriteresRechercheController.saisieCriteresRecherche().url">
                            Modifier mes critères
                        </a>
                    </div>
                </div>
                <pagination ref="pagination"
                            v-bind:nb-par-page="nbOffresParPage"
                            v-on:charger-page-suivante="chargerPageSuivante"
                            v-on:charger-page-precedente="chargerPagePrecedente"
                            v-bind:pages-initiales="pagesInitiales"></pagination>
            </section>
        </div>
    </div>
    @components.jsData(jsData)
    <script src="@assetsFinder.path("javascripts/candidatListeOffres.js")" type="text/javascript"></script>
}