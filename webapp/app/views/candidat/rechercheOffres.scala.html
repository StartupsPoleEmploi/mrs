@import conf.WebAppConfig
@import fr.poleemploi.perspectives.authentification.domain.CandidatAuthentifie
@import helper._
@import play.api.libs.json.JsObject

@(candidatAuthentifie: Option[CandidatAuthentifie],
        jsData: JsObject)(implicit flash: Flash, assetsFinder: AssetsFinder, webAppConfig: WebAppConfig)

@layout(candidatAuthentifie = candidatAuthentifie) {
    <div id="rechercheOffres" v-cloak>
        <div id="js-modaleDetailOffre" class="modal" tabindex="-1" role="dialog" aria-labelledby="titreModaleDetailOffre">
            <div class="modal-dialog modaleDetailOffre" role="document">
                <div class="modal-content">
                    <div class="modaleDetailOffre-wrapper">
                        <div>
                            <div>
                                <p id="titreModaleDetailOffre">{{offreCourante.intitule}}</p>
                                <span class="modaleDetailOffre-fermer" data-dismiss="modal">&times;</span>
                            </div>
                            <div class="modaleDetailOffre-colonne resume">
                                <p>{{offreCourante.nomEntreprise}}</p>
                                <p>
                                    <img src="@assetsFinder.path("images/commun/localisation.svg")" alt="Localisation" height="20" width="14" />
                                    {{offreCourante.libelleLieuTravail}}
                                </p>
                                <p>Actualisée le {{offreCourante.dateActualisation | date}}</p>
                            </div>
                            <div>
                                <p>Description</p>
                                <p v-show="offreCourante.description">{{offreCourante.description}}</p>
                            </div>
                            <div>
                                <p>Profil souhaité</p>
                                <p>{{offreCourante.libelleExperience}}</p>
                                <p>Savoirs et savoir-faire :</p>
                                <ul>
                                    <li v-for="competence in offreCourante.competences">
                                        {{competence}}
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <p>Entreprise</p>
                                <p v-show="offreCourante.nomEntreprise">{{offreCourante.nomEntreprise}}</p>
                                <p v-show="offreCourante.descriptionEntreprise">{{offreCourante.descriptionEntreprise}}</p>
                                <p v-show="offreCourante.effectifEntreprise">{{offreCourante.effectifEntreprise}}</p>
                                <p v-show="offreCourante.urlEntreprise">{{offreCourante.urlEntreprise}}</p>
                            </div>
                            <div>
                                <div>
                                    <div>{{offreCourante.libelleTypeContrat}}</div>
                                    <div>{{offreCourante.libelleDureeTravail}}</div>
                                    <div>Salaire : {{offreCourante.libelleSalaire}}</div>
                                </div>
                                <div>
                                    <p><b>Cette offre vous intéresse ?</b></p>
                                    <p v-show="display.contact"><b>Postuler en contactant directement :</b></p>
                                    <button v-show="!display.contact" v-on:click="display.contact = true">Contacter le recruteur</button>
                                    <div v-show="display.contact">
                                        <p v-show="offreCourante.nomContact"><b>{{offreCourante.nomContact}}</b></p>
                                        <p v-show="offreCourante.telephoneContact">{{offreCourante.telephoneContact}}</p>
                                        <p v-show="offreCourante.emailContact">{{offreCourante.emailContact}}</p>
                                        <p v-show="offreCourante.coordonneesContact1">{{offreCourante.coordonneesContact1}}</p>
                                        <p v-show="offreCourante.coordonneesContact2">{{offreCourante.coordonneesContact2}}</p>
                                        <p v-show="offreCourante.coordonneesContact3">{{offreCourante.coordonneesContact3}}</p>
                                        <p v-show="!offreCourante.telephoneContact && !offreCourante.emailContact && !offreCourante.coordonneesContact1 && !offreCourante.coordonneesContact2 && !offreCourante.coordonneesContact3">
                                            <a target="_blank" v-bind:href="offreCourante.urlOrigine">{{offreCourante.urlOrigine}}</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="rechercheOffres">
            <section class="rechercheOffres-criteres">

            </section>
            <section class="rechercheOffres-offres">
                <p v-show="offres.length > 0"><b>{{offres.length}} offres d'emploi</b> peuvent vous intéresser</p>
                <div v-show="offres.length > 0">
                    <template v-for="(offre, index) in offres">
                        <div v-on:click="toggleOffreCourante(offre)" v-show="afficherOffre(index)">
                            <div>
                                <p>{{offre.intitule}}</p>
                                <p>{{offre.nomEntreprise | capitalize}}</p>
                                <p>{{offre.libelleLieuTravail}}</p>
                            </div>
                            <div>
                                <b>{{offre.typeContrat}}</b>
                            </div>
                        </div>
                    </template>
                </div>
                <div v-show="offres.length === 0">
                    <p><b>Désolé, nous n'avons pas d'offres à vous proposer pour l'instant :(</b></p>
                    <p>Vous pouvez élargir votre recherche en modifiant vos critères ou réessayer plus tard</p>
                </div>
                <pagination ref="pagination"
                v-bind:nb-par-page="nbOffresParPage"
                v-on:charger-page-suivante="chargerPageSuivante"
                v-on:charger-page-precedente="chargerPagePrecedente"
                v-bind:pages-initiales="pagesInitiales"></pagination>
            </section>
        </div>
    </div>
    @components.jsData(jsData)
    <script src="@assetsFinder.path("javascripts/candidatRechercheOffres.js")" type="text/javascript"></script>
}