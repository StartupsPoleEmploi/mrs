@import conf.WebAppConfig
@import fr.poleemploi.perspectives.authentification.domain.ConseillerAuthentifie
@import play.api.libs.json.JsObject

@(conseillerAuthentifie: ConseillerAuthentifie,
        jsData: JsObject)(implicit flash: Flash, assetsFinder: AssetsFinder, webAppConfig: WebAppConfig)

@layout(conseillerAuthentifie = conseillerAuthentifie) {
<div id="listeCandidats" class="bg-gris" v-cloak>
    <section class="container" v-show="display.mrsDHAEForm">
        <div class="row">
            <header class="col-12 text-center font-size-md">Ajouter une MRS DHAE pour {{candidatCourant.prenom}} {{candidatCourant.nom}}</header>
            <form id="mrsDHAEForm" class="col-12" action="@controllers.conseiller.routes.ConseillerController.ajouterMRSDHAECandidat()" method="post"
                v-on:submit.prevent="ajouterMRSCandidat">
                <input type="hidden" name="csrfToken" v-bind:value="csrfToken" />
                <input type="hidden" name="candidatId" v-model="mrsDHAEFormData.candidatId" />
                <ol class="list-unstyled">
                    <li class="row pb-4">
                        <label class="col-12 texte-noir mb-3" for="codeDepartement">Département (unité MRS)</label>
                        <div class="col-4">
                            <input id="codeDepartement" type="text" name="codeDepartement" maxlength="2"
                                   class="texte-noir font-size-sm px-3 py-3 input"
                                   v-model="mrsDHAEFormData.codeDepartement" />
                        </div>
                        <div v-for="error in mrsDHAEFormErrors.codeDepartement" class="col-12 texte-erreur font-size-sm mt-1">{{error}}</div>
                    </li>
                    <li class="row pb-4">
                        <label class="col-12 texte-noir mb-3" for="codeROME">Code ROME</label>
                        <div class="col-4">
                            <select id="codeROME" name="codeROME"
                                    v-model="mrsDHAEFormData.codeROME">
                                <option value="">Choisissez un code ROME</option>
                                <option v-for="codeROME in codeROMEs" v-bind:value="codeROME">{{codeROME}}</option>
                            </select>
                        </div>
                        <div v-for="error in mrsDHAEFormErrors.codeROME" class="col-12 texte-erreur font-size-sm mt-1">{{error}}</div>
                    </li>
                    <li class="row pb-4">
                        <label class="col-12 texte-noir mb-3" for="dateEvaluation">Date d'évaluation</label>
                        <div class="col-4">
                            <input type="date" name="dateEvaluation" id="dateEvaluation"
                                   v-model="mrsDHAEFormData.dateEvaluation" />
                        </div>
                        <div v-for="error in mrsDHAEFormErrors.dateEvaluation" class="col-12 texte-erreur font-size-sm mt-1">{{error}}</div>
                    </li>
                </ol>
                <button class="bouton bouton-action bouton--blancSurVert" type="submit">Ajouter</button>
                <button class="bouton bouton-action bouton--blancSurVert" type="button" v-on:click="annulerMRSDHAE">Annuler</button>
                <span class="texte-erreur" v-show="mrsDHAEFormErrors.globalError">{{mrsDHAEFormErrors.globalError}}</span>
            </form>
        </div>
    </section>

    <section class="container" v-show="display.candidats">
        <div class="row p-3">
            <div class="col-2">Nom du candidat</div>
            <div class="col-4">Métiers validés</div>
            <div class="col-4">Métiers recherchés</div>
        </div>
        <template v-for="candidat in candidats">
            <div class="row align-items-center p-3 bg-blanc cursor-pointer"
                 v-on:click="toggleCandidatCourant(candidat)"
                 v-bind:class="{'mb-3' : !estCandidatCourant(candidat)}">
                <div class="col-2">{{candidat.prenom}} {{candidat.nom}}</div>
                <div class="col-4">
                    <p v-if="candidat.metiersValides.length > 0">Metiers validés</p>
                    <ul>
                        <li v-for="metierValide in candidat.metiersValides">
                            {{metierValide.metier.codeROME}} : {{metierValide.metier.label}}, dans le {{metierValide.departement}}.
                            <span class="font-weight-bold" v-show="metierValide.isDHAE">DHAE</span>
                        </li>
                    </ul>
                    <p v-if="candidat.metiersValidesRecherches.length > 0">Metiers validés recherchés</p>
                    <ul class="detailsProfils">
                        <li class="detailsProfils-item" v-for="metier in candidat.metiersValidesRecherches">{{metier.codeROME}} : {{metier.label}}</li>
                    </ul>
                </div>
                <div class="col-4">
                    <ul class="detailsProfils">
                        <li class="detailsProfils-item" v-for="metier in candidat.metiersRecherches">{{metier.codeROME}} : {{metier.label}}</li>
                    </ul>
                </div>
                <div class="col-2">
                    <img src="@assetsFinder.path("images/commun/ouvrir-detail.svg")"
                         alt="Plus de détails" height="16" width="16" class="voirProfil--ferme"
                         v-show="!estCandidatCourant(candidat)" />
                    <img src="@assetsFinder.path("images/commun/fermer-detail.svg")"
                         alt="Moins de détails" height="16" width="16" class="voirProfil--ouvert"
                         v-show="estCandidatCourant(candidat)" />
                    Détail
                </div>
            </div>
            <div class="row p-3 mb-3 bg-noir texte-blanc" v-show="estCandidatCourant(candidat)">
                <div class="col-5">
                    <div>Email : {{candidat.email}}</div>
                    <div>Telephone : {{candidat.numeroTelephone}}</div>
                    <div>Demandeur d'emploi : {{candidat.statutDemandeurEmploi | statutDemandeurEmploi}}</div>
                    <div>Inscription : {{candidat.dateInscription | date}}</div>
                    <div>Derniere connexion : {{candidat.dateDerniereConnexion | date}}</div>
                </div>
                <div class="col-4">
                    <div v-if="candidat.communeRecherche">Commune : {{candidat.communeRecherche}}</div>
                    <div v-if="candidat.codePostalRecherche">Code postal : {{candidat.codePostalRecherche}}</div>
                    <div v-if="candidat.rayonRecherche">Rayon de recherche : {{candidat.rayonRecherche.value}}km</div>
                    <div v-if="candidat.contactRecruteur">Contact recruteur : {{candidat.contactRecruteur | boolean}}</div>
                    <div v-if="candidat.contactFormation">Contact formation : {{candidat.contactFormation | boolean}}</div>
                </div>
                <div class="col-3">
                    <ul class="list-unstyled">
                        <li>
                            <button class="bouton bouton-action bouton--blancSurVert"
                                  v-on:click="initialiserMRSDHAEForm(candidat)">
                                Ajouter une MRS DHAE
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </template>
    </section>
    <pagination ref="pagination"
                v-show="display.candidats"
                v-on:charger-page="chargerPage"
                v-bind:nb-pages="pages.length"></pagination>
</div>

@commun.jsData(jsData)
<script src="@assetsFinder.path("javascripts/conseillerListeCandidats.js")" type="text/javascript"></script>
}